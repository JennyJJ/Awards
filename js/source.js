"use strict";var four51={};four51.app=angular.module("451order",["ngResource","ngRoute","ngAnimate","ngSanitize","ngCookies","ngTouch","ui.validate","ui.mask","headroom","ui.bootstrap","angulartics","angulartics.google.analytics"]),four51.app.constant("AppConst",{debug:!0}),four51.app.factory("$451",["AppConst",function(n){function t(n,t,i){if(n!=null&&t!=null){var r=[];return angular.forEach(n,function(n){var e,u,f;if(n[t.Property]!==undefined||!(!t instanceof Array)){if(e=function(t){if(n[t.Property]===t.Value)return n},t instanceof Array){for(f=0;f<t.length;f++)if(u=e(t[f]),u)break}else u=e(t);u&&(r.push(n),i&&i(n))}}),r}}function i(n,t){if(angular.isArray(t)){var i=!1;return angular.forEach(t,function(t){i=i?i:n.indexOf(t)>-1}),i}return n.indexOf(t)>-1}var r=function(n){return n>>>0===parseFloat(n)};return{debug:n.debug,isAnon:four51IsAnonUser,apiName:four51.apiName(),api:function(n){return"/api/"+four51.apiName()+"/"+n},filter:function(n,i,r){return t(n,i,r)},contains:function(n,t){return i(n,t)},isPositiveInteger:r}}]),four51.apiName=function(){return four51.app.ApiAppName?four51.app.ApiAppName:window.location.pathname.split("/")[1]},four51.app.filter("onproperty",["$451",function(n){var t={OrderStats:"Type",Message:"Box"};return function(i,r){if(i&&i.length!==0)return r?(r.Property=r.Property||t[r.Model],n.filter(i,r)):i}}]),four51.app.filter("kb",function(){return function(n){return isNaN(n)?n:parseFloat(n)/1024}}),four51.app.filter("noliverates",function(){return function(n){var t=[];return angular.forEach(n,function(n){n.ShipperRateType!="ActualRates"&&t.push(n)}),t}}),four51.app.config(["$locationProvider",function(n){n.html5Mode(!1)}]),four51.app.config(["$provide",function(n){n.decorator("$exceptionHandler",["$delegate","$injector",function(n,t){return function(i,r){n(i,r),t.get("$rootScope").$broadcast("exception",i,r)}}])}]),four51.app.config(["datepickerConfig","datepickerPopupConfig",function(n,t){n.showWeeks=!1,t.showButtonBar=!1,t.appendToBody=!0}]),four51.app.config(["$routeProvider","$locationProvider",function(n,t){t.html5Mode(!0);var i=function(n){return"productview.hcf?id="+n.productInteropID},r=function(n){return"specform.hcf?id="+n.productInteropID};n.when("/listOrders",{templateUrl:"partials/listOrders.html",controller:"ListOrdersCtrl"}).when("/orderdetails/:orderid",{templateUrl:"partials/orderDetails.html",controller:"OrderDetailsCtrl"}).when("/catalog",{templateUrl:"partials/categoryView.html",controller:"CategoryCtrl"}).when("/catalog/:categoryInteropID",{templateUrl:"partials/categoryView.html",controller:"CategoryCtrl"}).when("/product/:productInteropID",{templateUrl:i,controller:"ProductCtrl"}).when("/product/:productInteropID/:variantInteropID",{templateUrl:i,controller:"ProductCtrl"}).when("/product/:productInteropID/:variantInteropID/edit",{templateUrl:r,controller:"SpecFormCtrl"}).when("/order",{templateUrl:"partials/orderSearchView.html",controller:"OrderSearchCtrl"}).when("/order/:id",{templateUrl:"partials/Reporting/orderHistoryView.html",controller:"OrderViewCtrl"}).when("/favoriteorders",{templateUrl:"partials/favoriteOrderListView.html",controller:"FavoriteOrderCtrl"}).when("/order/:orderid/:lineitemindex/",{templateUrl:"partials/Reporting/lineItemHistoryView.html",controller:"LineItemViewCtrl"}).when("/message",{templateUrl:"partials/messageListView.html",controller:"MessageListCtrl"}).when("/message/:id",{templateUrl:"partials/messageView.html",controller:"MessageViewCtrl"}).when("/admin",{templateUrl:"partials/userView.html",controller:"UserEditCtrl"}).when("/addresses",{templateUrl:"partials/addressListView.html",controller:"AddressListCtrl"}).when("/address",{templateUrl:"partials/addressView.html",controller:"AddressViewCtrl"}).when("/address/:id",{templateUrl:"partials/addressView.html",controller:"AddressViewCtrl"}).when("/cart",{templateUrl:"partials/cartView.html",controller:"CartViewCtrl"}).when("/checkout",{templateUrl:"partials/checkOutView.html",controller:"CheckOutViewCtrl"}).when("/cart/:productInteropID/:lineItemIndex",{templateUrl:i,controller:"LineItemEditCtrl"}).when("/login",{templateUrl:"partials/controls/login.html",controller:"LoginCtrl"}).when("/search",{templateUrl:"partials/searchView.html",controller:"ProductSearchCtrl"}).when("/search/:searchTerm",{templateUrl:"partials/searchView.html",controller:"ProductSearchCtrl"}).when("/security",{templateUrl:"partials/security.html",controller:"SecurityCtrl"}).when("/conditions",{templateUrl:"partials/conditions.html",controller:"ConditionsCtrl"}).when("/reports",{templateUrl:"partials/reportsView.html",controller:"ReportsCtrl"}).when("/report/:id",{templateUrl:"partials/Reporting/reportView.html",controller:"ReportCtrl"}).otherwise({redirectTo:"/catalog"})}]),four51.app.controller("Four51Ctrl",["$scope","$route","$location","$451","User","Order","Security","OrderConfig","Category","AppConst",function(n,t,i,r,u,f,e,o,s,h){function c(){e.isAuthenticated()&&(u.get(function(t){n.user=t,n.user.TermsAccepted||i.path("conditions"),t.CurrentOrderID?f.get(t.CurrentOrderID,function(i){n.currentOrder=i,o.costcenter(i,t)}):n.currentOrder=null}),s.tree(function(t){n.tree=t,n.$broadcast("treeComplete",t)}))}function l(n){n.length!=0&&(function(n,t,i,r,u,f,e){n.GoogleAnalyticsObject=u,n[u]=n[u]||function(){(n[u].q=n[u].q||[]).push(arguments)},n[u].l=1*new Date,f=t.createElement(i),e=t.getElementsByTagName(i)[0],f.async=1,f.src=r,e.parentNode.insertBefore(f,e)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",n,"four51.com"),ga("require","ecommerce","ecommerce.js"))}function a(){e.clear()}if(n.AppConst=h,n.scroll=0,n.isAnon=r.isAnon,n.Four51User=e,r.isAnon&&!e.isAuthenticated()&&u.login(function(){t.reload()}),$(window).width()<960)$(document).on("focus",':input:not("button")',function(){$(".navbar-fixed-bottom, .headroom.navbar-fixed-top").addClass("ng-hide")}).on("blur",":input",function(){$(".navbar-fixed-bottom, .headroom.navbar-fixed-top").removeClass("ng-hide")});n.errorSection="",n.$on("event:auth-loginConfirmed",function(){t.reload(),u.get(function(n){l(n.Company.GoogleAnalyticsCode)})}),n.$on("$routeChangeSuccess",c),n.$on("event:auth-loginRequired",a)}]),four51.app.controller("CategoryCtrl",["$routeParams","$sce","$scope","$451","Category","Product","Nav",function(n,t,i,r,u,f,e){i.productLoadingIndicator=!0,i.trusted=function(n){if(n)return t.trustAsHtml(n)},f.search(n.categoryInteropID,null,null,function(n){i.products=n,i.productLoadingIndicator=!1}),n.categoryInteropID?(i.categoryLoadingIndicator=!0,u.get(n.categoryInteropID,function(n){i.currentCategory=n,i.categoryLoadingIndicator=!1})):i.tree&&(i.currentCategory={SubCategories:i.tree}),i.$on("treeComplete",function(){n.categoryInteropID||(i.currentCategory={SubCategories:i.tree})}),i.navStatus=e.status,i.toggleNav=e.toggle}]),four51.app.controller("ErrorCtrl",["$scope",function(n){n.open=function(){n.isError=!0},n.close=function(){n.isError=!1},n.opts={backdropFade:!0,dialogFade:!0},n.$on("exception",function(t,i){var r=i.data?i.data:i;try{n.error={Message:r.Message||"",Detail:r.ExceptionMessage||r.message,Code:r.ExceptionType||"",StackTrace:r.StackTrace||""},console.dir(n.error)}catch(u){console.log("An error occurred while handling an error. Consult the object written to the log. Keep in mind you must use the Error() if you are throwing an error in your JavaScript"),console.dir(t),console.dir(r)}}),n.template={url:"partials/errorView.html"}}]),four51.app.controller("LoginCtrl",["$scope","$sce","$route","User",function(n,t,i,r){var u=["PasswordSecurityException"];n.loginMessage=null,n.buttonText="Logon",n.$on("event:auth-loginFailed",function(t,i){n.loginMessage=i}),n.login=function(){n.loginMessage=null,angular.forEach(u,function(t){n[t]=null}),r.login(n.credentials,function(t){n.credentials.Email&&(n.loginMessage=t.LogonInfoSent,n.EmailNotFoundException=!1,n.showEmailHelp=!1,n.credentials.Email=null,n.credentials.Username=null,n.credentials.Password=null)},function(i){n.credentials={},n[i.Code.text]=!0,i.Code.is("PasswordSecurity")&&(n.loginMessage=t.trustAsHtml(i.Message)),i.Code.is("EmailNotFoundException")&&n.credentials.Email&&(n.loginMessage=t.trustAsHtml(i.Detail)),n.credentials.Username=null,n.credentials.Password=null,n.credentials.CurrentPassword=null,n.credentials.NewPassword=null,n.credentials.ConfirmPassword=null})}}]),four51.app.controller("OrderSearchCtrl",["$scope","$location","OrderSearchCriteria","OrderSearch",function(n,t,i,r){function u(n,t){var i=!1;return angular.forEach(n,function(n){(i||n.Type==t&&n.Count>0)&&(i=!0)}),i}i.query(function(t){n.OrderSearchCriteria=t,n.hasStandardTypes=u(t,"Standard"),n.hasReplenishmentTypes=u(t,"Replenishment"),n.hasPriceRequestTypes=u(t,"PriceRequest")}),n.OrderSearch=function(t,i){t.preventDefault(),n.showNoResults=!1,r.search(i,function(t){n.orders=t,n.showNoResults=t.length==0}),n.orderSearchStat=i}}]),four51.app.controller("OrderViewCtrl",["$scope","$location","$routeParams","Order","FavoriteOrder","Address","User",function(n,t,i,r,u,f,e){n.loadingIndicator=!0;var o=function(n){if(!n)return!1;var t=!1;return angular.forEach(n.LineItems,function(i,r){t=t||r>0?i.ShipAddressID!=n.LineItems[r-1].ShipAddressID:!1}),t};r.get(i.id,function(t){n.loadingIndicator=!1,n.order=t,n.hasSpecsOnAnyLineItem=!1;for(var i=0;i<t.LineItems.length;i++)if(t.LineItems[i].Specs){n.hasSpecsOnAnyLineItem=!0;break}n.hasShipperOnAnyLineItem=function(){return angular.forEach(t.LineItems,function(n){if(n.ShipperID)return!0}),!1},n.hasShipAccountOnAnyLineItem=function(){return angular.forEach(t.LineItems,function(n){if(n.ShipAccount)return!0}),!1},o(t)?angular.forEach(t.LineItems,function(n){n.ShipAddressID&&f.get(n.ShipAddressID,function(t){n.ShipAddress=t})}):f.get(t.ShipAddressID||t.LineItems[0].ShipAddressID,function(n){t.ShipAddress=n}),f.get(t.BillAddressID,function(n){t.BillAddress=n})}),n.saveFavorite=function(){n.displayLoadingIndicator=!0,u.save(n.order,function(){n.displayLoadingIndicator=!1})},n.repeatOrder=function(){n.order.Repeat=!0,r.save(n.order,function(i){n.currentOrder=i,n.user.CurrentOrderID=i.ID,e.save(n.user,function(i){n.user=i,t.path("/cart")})})},n.onPrint=function(){window.print()}}]),four51.app.controller("LineItemViewCtrl",["$scope","$routeParams","Order","Product",function(n,t,i,r){i.get(t.orderid,function(i){n.order=i,n.LineItem=i.LineItems[t.lineitemindex],r.get(n.LineItem.Product.InteropID,function(t){n.StaticSpecGroups=t.StaticSpecGroups||{},angular.forEach(n.LineItem.Specs,function(n){n.VisibleToCustomer=!0}),n.StaticSpecGroups.VariableSpecs={Name:"Variable Specs",Specs:n.LineItem.Specs}})})}]),four51.app.controller("NavCtrl",["$location","$route","$scope","$451","User",function(n,t,i,r,u){i.Logout=function(){u.logout(),i.isAnon&&(n.path("/catalog"),u.login())},i.refreshUser=function(){store.clear()},i.isActive=function(t){var r=n.path().replace("/",""),i=!1;return t instanceof Array?angular.forEach(t,function(n){n!=r||i||(i=!0)}):r==t&&(i=!0),i},i.isInPath=function(t){var r=n.path().replace("/",""),i=!1;return i=r.indexOf(t)>-1?!0:!1},i.Clear=function(){localStorage.clear(),t.reload()},i.$on("event:orderUpdate",function(n,t){i.cartCount=t?t.Status=="Unsubmitted"||t.Status=="AwaitingApproval"?t.LineItems.length:null:null})}]),four51.app.controller("ProductCtrl",["$scope","$routeParams","$route","$location","$451","Product","ProductDisplayService","Order","Variant","User",function(n,t,i,r,u,f,e,o,s,h){function c(t){n.LineItem.Quantity=t.Product.StandardPriceSchedule.DefaultQuantity>0?t.Product.StandardPriceSchedule.DefaultQuantity:null}n.selected=1,n.LineItem={},n.addToOrderText="Add To Cart",n.loadingIndicator=!0,n.calcVariantLineItems=function(){n.variantLineItemsOrderTotal=0,angular.forEach(n.variantLineItems,function(t){n.variantLineItemsOrderTotal+=t.LineTotal||0})},e.getProductAndVariant(t.productInteropID,t.variantInteropID,function(t){n.LineItem.Product=t.product,n.LineItem.Variant=t.variant,c(n.LineItem),e.setNewLineItemScope(n),e.setProductViewScope(n),n.$broadcast("ProductGetComplete"),n.loadingIndicator=!1,n.setAddToOrderErrors()}),n.addToOrder=function(){if(n.lineItemErrors&&n.lineItemErrors.length){n.showAddToCartErrors=!0;return}n.currentOrder||(n.currentOrder={},n.currentOrder.LineItems=[]),n.allowAddFromVariantList?angular.forEach(n.variantLineItems,function(t){t.Quantity>0&&n.currentOrder.LineItems.push(t)}):n.currentOrder.LineItems.push(n.LineItem),n.addToOrderIndicator=!0,o.save(n.currentOrder,function(t){n.user.CurrentOrderID=t.ID,h.save(n.user,function(){n.addToOrderIndicator=!0,r.path("/cart")})},function(t){n.addToOrderIndicator=!1,n.addToOrderError=t.Message,i.reload()})}}]),four51.app.controller("ProductListCtrl",["$routeParams","$rootScope","$scope","Product",function(n,t,i,r){i.loadSearch=function(){if(i.category&&i.category.products){i.Products=i.category.products;return}i.category&&r.search(i.categoryInteropID,null,null,function(n){i.category.products=i.Products=n})}}]),four51.app.controller("MessageListCtrl",["$scope","MessageList",function(n,t){t.query(function(t){n.messages=t}),n.checkAll=function(t){angular.forEach(n.messages,function(n){n.Selected=t.currentTarget.checked})},n.deleteSelected=function(){n.displayLoadingIndicator=!0,t.delete(n.messages,function(){t.query(function(t){n.messages=t,n.displayLoadingIndicator=!1})})}}]),four51.app.controller("MessageViewCtrl",["$scope","$location","$routeParams","Message",function(n,t,i,r){r.get(i.id,function(t){n.message=t,n.canReply=function(){return t.Box=="Inbox"}}),n.delete=function(i){i.preventDefault(),r.delete(n.message,function(){t.path("/message")})},n.ok=function(){t.path("/message")},n.send=function(){r.save(n.message,function(){t.path("/message")})}}]),four51.app.controller("FavoriteOrderCtrl",["$scope","$location","$routeParams","FavoriteOrder","Order","User",function(n,t,i,r,u,f){r.query(function(t){n.favoriteorders=t}),n.repeat=function(i){i.Repeat=!0,u.save(i,function(i){n.currentOrder=i,n.user.CurrentOrderID=i.ID,f.save(n.user,function(i){n.user=i,t.path("/cart")})})},n.checkAll=function(t){angular.forEach(n.favoriteorders,function(n){n.Selected=t.currentTarget.checked})},n.deleteSelected=function(){r.delete(n.favoriteorders,function(){r.query(function(t){n.favoriteorders=t})})},n.saveFavoriteNow=function(){t.path("order")}}]),four51.app.controller("UserEditCtrl",["$scope","$location","$sce","User",function(n,t,i,r){n.loginasuser={},n.actionMessage=null,n.user.Type!="TempCustomer"&&(n.user.TempUsername=n.user.Username),n.save=function(){n.actionMessage=null,n.securityWarning=!1,n.user.Username=n.user.TempUsername,n.displayLoadingIndicator=!0,n.user.Type=="TempCustomer"&&(n.user.ConvertFromTempUser=!0),r.save(n.user,function(t){n.securityWarning=!1,n.displayLoadingIndicator=!1,n.actionMessage="Your changes have been saved",n.user.TempUsername=t.Username},function(t){n.displayLoadingIndicator=!1,t.Code.is("PasswordSecurity")?n.securityWarning=!0:n.actionMessage=i.trustAsHtml(t.Message)})},n.loginExisting=function(){r.login({Username:n.loginasuser.Username,Password:n.loginasuser.Password,ID:n.user.ID,Type:n.user.Type},function(){t.path("/catalog")})}}]),four51.app.controller("GiftCardRedemptionCtrl",function(n,t){n.redeemGiftCard=function(){n.$parent.gcMessage=null,t.redeem(this.giftcard,function(t){n.giftcard=t},function(t){n.$parent.gcMessage=t.Message})}}),four51.app.controller("AddressInputCtrl",["$scope","$rootScope","$location","User","Address","Resources",function(n,t,i,r,u,f){n.save=function(){n.objectExists=!1,u.save(this.address,function(r){t.$broadcast("event:AddressSaved",r),i.path(n.return)},function(t){t.Code.is("ObjectExistsException")&&(n.objectExists=!0)})},n.delete=function(){u.delete(this.address,function(){i.path(n.return)})},n.cancel=function(){n.return?i.path(n.return):t.$broadcast("event:AddressCancel")},n.countries=f.countries,n.states=f.states,n.country=function(t){return n.address!=null?n.address.Country==t.country:!1},n.hasStates=function(){return n.address!=null?n.address.Country=="US"||n.address.Country=="CA"||n.address.Country=="NL":!1},n.isPhoneRequired=function(){return n.user.Permissions.contains("BillingAddressPhoneRequired")&&n.address.IsBilling||n.user.Permissions.contains("ShipAddressPhoneRequired")&&n.address.IsShipping}}]),four51.app.controller("AddressListCtrl",["$scope","$location","$451","AddressList",function(n,t,i,r){r.query(function(t){n.addresses=t}),n.deleteSelected=function(){n.displayLoadingIndicator=!0,r.delete(n.addresses,function(){r.query(function(t){n.addresses=t,n.displayLoadingIndicator=!1})})},n.newAddress=function(){t.path("address")},n.checkAll=function(t){angular.forEach(n.addresses,function(n){n.Selected=t.currentTarget.checked})}}]),four51.app.controller("AddressViewCtrl",["$scope","$routeParams","Address",function(n,t,i){t.id?i.get(t.id,function(t){n.address=t}):n.address={Country:"US"},n.return="/addresses"}]),four51.app.controller("CartViewCtrl",["$scope","$location","$451","Order","OrderConfig","User",function(n,t,i,r,u,f){n.currentDate=new Date,n.errorMessage=null,n.continueShopping=function(){n.cart.$invalid?t.path("catalog"):confirm("Do you want to save changes to your order before continuing?")==!0&&n.saveChanges(function(){t.path("catalog")})},n.cancelOrder=function(){confirm("Are you sure you wish to cancel your order?")==!0&&(n.displayLoadingIndicator=!0,n.actionMessage=null,r.delete(n.currentOrder,function(){n.currentOrder=null,n.user.CurrentOrderID=null,f.save(n.user,function(){t.path("catalog")}),n.displayLoadingIndicator=!1,n.actionMessage="Your Changes Have Been Saved!"},function(t){n.actionMessage="An error occurred: "+t.Message,n.displayLoadingIndicator=!1}))},n.saveChanges=function(t){n.actionMessage=null,n.errorMessage=null,n.currentOrder.LineItems.length==i.filter(n.currentOrder.LineItems,{Property:"Selected",Value:!0}).length?n.cancelOrder():(n.displayLoadingIndicator=!0,u.address(n.currentOrder,n.user),r.save(n.currentOrder,function(i){n.currentOrder=i,n.displayLoadingIndicator=!1,t&&t(),n.actionMessage="Your Changes Have Been Saved!"},function(t){n.errorMessage=t.Message,n.displayLoadingIndicator=!1}))},n.removeItem=function(t){n.currentOrder.LineItems.length>1?confirm("Are you sure you wish to remove this item from your cart?")==!0&&(t.Selected=!0,n.saveChanges()):(t.Selected=!0,n.saveChanges())},n.checkOut=function(){n.displayLoadingIndicator=!0,u.address(n.currentOrder,n.user),r.save(n.currentOrder,function(i){n.currentOrder=i,t.path("checkout"),n.displayLoadingIndicator=!1},function(t){n.errorMessage=t.Message,n.displayLoadingIndicator=!1})},n.$watch("currentOrder.LineItems",function(){var i=0;if(!n.currentOrder)return i;angular.forEach(n.currentOrder.LineItems,function(n){i+=n.LineTotal}),n.currentOrder.Subtotal=i},!0),n.copyAddressToAll=function(){angular.forEach(n.currentOrder.LineItems,function(t){t.DateNeeded=n.currentOrder.LineItems[0].DateNeeded})},n.copyCostCenterToAll=function(){angular.forEach(n.currentOrder.LineItems,function(t){t.CostCenter=n.currentOrder.LineItems[0].CostCenter})},n.onPrint=function(){window.print()}}]),four51.app.controller("CheckOutViewCtrl",["$scope","$location","$filter","$rootScope","$451","Analytics","User","Order","OrderConfig","FavoriteOrder","AddressList",function(n,t,i,r,u,f,e,o,s,h,c){function a(){n.displayLoadingIndicator=!0,n.errorMessage=null,o.submit(n.currentOrder,function(i){n.user.CurrentOrderID=null,e.save(n.user,function(t){n.user=t,n.displayLoadingIndicator=!1}),n.currentOrder=null,t.path("/order/"+i.ID)},function(t){n.errorMessage=t.Message,n.displayLoadingIndicator=!1,n.shippingUpdatingIndicator=!1,n.shippingFetchIndicator=!1})}function l(t){n.displayLoadingIndicator=!0,n.errorMessage=null,n.actionMessage=null;var i=n.currentOrder.autoID;s.address(n.currentOrder,n.user),o.save(n.currentOrder,function(r){n.currentOrder=r,i&&(n.currentOrder.autoID=!0,n.currentOrder.ExternalID="auto"),n.displayLoadingIndicator=!1,t&&t(n.currentOrder),n.actionMessage="Your changes have been saved"},function(t){n.currentOrder.ExternalID=null,n.errorMessage=t.Message,n.displayLoadingIndicator=!1,n.shippingUpdatingIndicator=!1,n.shippingFetchIndicator=!1})}n.currentOrder||t.path("catalog"),c.query(function(t){n.addresses=t}),n.hasOrderConfig=s.hasConfig(n.currentOrder,n.user),n.checkOutSection=n.hasOrderConfig?"order":"shipping",n.shipaddress={Country:"US",IsShipping:!0,IsBilling:!1},n.billaddress={Country:"US",IsShipping:!1,IsBilling:!0},n.$on("event:AddressSaved",function(t,i){i.IsShipping&&(n.currentOrder.ShipAddressID=i.ID,n.shipToMultipleAddresses||n.setShipAddressAtOrderLevel(),n.addressform=!1),i.IsBilling&&(n.currentOrder.BillAddressID=i.ID,n.billaddressform=!1),c.query(function(t){n.addresses=t}),n.shipaddress={Country:"US",IsShipping:!0,IsBilling:!1},n.billaddress={Country:"US",IsShipping:!1,IsBilling:!0}}),n.continueShopping=function(){confirm("Do you want to save changes to your order before continuing?")==!0?l(function(){t.path("catalog")}):t.path("catalog")},n.cancelOrder=function(){confirm("Are you sure you wish to cancel your order?")==!0&&(n.displayLoadingIndicator=!0,o.delete(n.currentOrder,function(){n.user.CurrentOrderID=null,n.currentOrder=null,e.save(n.user,function(i){n.user=i,n.displayLoadingIndicator=!1,t.path("catalog")})},function(t){n.actionMessage=t.Message,n.displayLoadingIndicator=!1}))},n.saveChanges=function(){l()},n.submitOrder=function(){a()},n.saveFavorite=function(){h.save(n.currentOrder)}}]),four51.app.controller("ApprovalInputCtrl",["$scope","$rootScope","Order",function(n,t,i){n.approveOrder=function(){n.loadingIndicator=!0,n.order.Approve=!0,i.submit(n.order,function(t){n.order=t,n.loadingIndicator=!1},function(t){n.loadingIndicator=!1,n.error=t.Detail})},n.declineOrder=function(){n.loadingIndicator=!0,n.order.Decline=!0,i.submit(n.order,function(t){n.order=t,n.loadingIndicator=!1})}}]),four51.app.controller("SpecFormCtrl",["$scope","$location","$route","$routeParams","ProductDisplayService","Variant",function(n,t,i,r,u,f){var e=r.variantInteropID=="new"?null:r.variantInteropID;u.getProductAndVariant(r.productInteropID,e,function(t){n.Product=t.product,e?n.Variant=t.variant:(n.Variant={},n.Variant.ProductInteropID=n.Product.InteropID,n.Variant.Specs={},angular.forEach(n.Product.Specs,function(t){t.CanSetForLineItem||(n.Variant.Specs[t.Name]=t)}))}),n.save=function(){f.save(n.Variant,function(i){t.path("/product/"+n.Product.InteropID+"/"+i.InteropID)})}}]),four51.app.controller("ConditionsCtrl",["$scope","$location","User",function(n,t,i){n.accept=function(){n.user.AcceptConditions=!0,i.save(n.user,function(){t.path("catalog")})}}]),four51.app.controller("ReportsCtrl",["$scope","$location","$451","SavedReports",function(n,t,i,r){r.query(function(t){n.Reports=t}),n.GetReport=function(t,i){t.preventDefault(),r.get(i,function(t){n.report=t})}}]),four51.app.controller("ReportCtrl",["$scope","$routeParams","$451","SavedReports",function(n,t,i,r){r.get(t.id,function(t){n.report=t})}]),four51.app.controller("ProductSearchCtrl",["$scope","Product","$routeParams","$location",function(n,t,i,r){i.searchTerm&&(n.searchTerm=i.searchTerm,t.search(null,n.searchTerm,null,function(t){n.products=t})),n.search=function(){r.path("/search/"+n.searchTerm)}}]),four51.app.controller("LineItemEditCtrl",["$scope","$routeParams","$location","Product","ProductDisplayService","Order",function(n,t,i,r,u,f){n.LineItem={},n.LineItem=n.currentOrder.LineItems[t.lineItemIndex],r.get(n.LineItem.Product.InteropID,function(t){n.LineItem.Product=t,u.setProductViewScope(n)}),n.allowAddToOrder=!0,n.addToOrderText="Save Line Item",n.addToOrder=function(){if(n.lineItemErrors&&n.lineItemErrors.length){n.showAddToCartErrors=!0;return}f.save(n.currentOrder,function(t){n.currentOrder=t,i.path("/cart")},function(n){console.log(n)})}}]),four51.app.controller("RelatedProductsCtrl",["$scope","Product","$sce",function(n,t,i){n.relatedgroupid&&(t.search(null,null,n.relatedgroupid,function(t){n.relatedProducts=t}),n.trusted=function(n){if(n)return i.trustAsHtml(n)})}]),four51.app.controller("shortProductViewCtrl",["$routeParams","$scope","ProductDisplayService",function(n,t,i){t.LineItem={},t.LineItem.Product=t.p,i.setNewLineItemScope(t),i.setProductViewScope(t),t.allowAddToOrderInProductList=t.allowAddToOrder&&t.LineItem.Specs.length==0&&t.LineItem.Product.Type!="VariableText"}]),four51.app.config(["$httpProvider",function(n){n.interceptors.push(["$q","$rootScope","$451","Security",function(n,t,i,r){function u(n){return n.headers.Authorization=r.auth(),n}return{request:function(t){return u(t)||n.when(u(t))},response:function(i){return i.status===202&&(r.init(i.data,i.headers()["www-authenticate"]),t.$broadcast("event:auth-loginConfirmed",i.data)),i||n.when(i)},responseError:function(i){if(i.status===401)return t.$broadcast("event:auth-loginRequired"),n.reject(i);if(i.status==403)return t.$broadcast("event:auth-loginFailed",i.data.Message),n.reject(i);if(i.status!=200)throw i;return n.reject(i)}}}])}]),four51.app.factory("Error",function(){var n=function(n){var t={Message:n.data.Message||n.Message||"",Detail:n.data.ExceptionMessage||n.ExceptionMessage||n.message,Code:{text:n.data.ExceptionType||n.ExceptionType||""},StackTrace:n.data.StackTrace||n.StackTrace||""};return t.Code.text=t.Code.text.replace("Four51.Framework.","").replace("DBExceptions+",""),t.Code.is=function(n){return t.Code.text.indexOf(n)>-1},t};return{format:n}}),four51.app.factory("Security",["$451","$cookieStore",function(n,t){var i="user."+n.apiName;return{init:function(n,r){this.currentUser={SiteID:n.SiteID,Username:n.Username,InteropID:n.InteropID,FirstName:n.FirstName,LastName:n.LastName,Email:n.Email,Auth:r},t.put(i,this.currentUser)},clear:function(){t.remove(i)},auth:function(){var n=t.get(i);return n?n.Auth:null},isAuthenticated:function(){return this.currentUser=t.get(i),!!this.currentUser},logout:function(){t.remove(i),delete this.currentUser}}}]),four51.app.factory("User",["$q","$rootScope","$resource","$451","Security","Error",function(n,t,i,r,u,f){function o(n,t){angular.isFunction(n)&&n(t)}function s(n){n.Permissions.contains=function(t){return r.contains(n.Permissions,t)},r.contains(n.Permissions,["PayByVisa","PayByMasterCard","PayByAmex","PayByDiscover","PayByDinersClub","PayByJCB","PayByDelta","PayBySwitch","PayBySolo","PayByElectron","PayByLaser"])&&n.Permissions.push("PayByCreditCard"),angular.forEach(n.CustomFields,function(n){n.ControlType=="File"&&n.File&&n.File.Url.indexOf("auth")==-1&&(n.File.Url+="&auth="+u.auth())}),n.Company.POIDMask=n.Company.POIDMask.toUpperCase()}var e="451Cache.User."+r.apiName,c=function(){store.remove(e),h()},h=function(n){var t=store.get(e);t?function(){s(t),o(n,t)}():i(r.api("user")).get().$promise.then(function(t){s(t),o(n,t),store.set(e,t)})},l=function(n,t,u){i(r.api("user")).save(n).$promise.then(function(n){s(n),o(t,n),store.set(e,n)},function(n){angular.isFunction(u)&&u(f.format(n))})},a=function(n,t,u){store.clear(),i(r.api("login")).get(n).$promise.then(function(n){o(t,n)},function(n){angular.isFunction(u)&&u(f.format(n))})},v=function(){store.clear(),u.logout()};return{get:h,login:a,save:l,logout:v,refresh:c}}]),four51.app.factory("ProductDisplayService",["$sce","$451","Variant","Product",function(n,t,i,r){function u(n){var h=n.PriceSchedule,o=n.Variant,l=n.Product,a=0,u=0,f=0,e=0,i,s=function(n){var i,r;if(n.isOtherSelected&&n.OtherValueMarkup>0&&(i=n.OtherValueMarkup),n.Options&&n.SelectedOptionID||i){if(r=n.SelectedOptionID?t.filter(n.Options,{Property:"ID",Value:n.SelectedOptionID})[0]:null,!r&&!i)return;n.MarkupType==="AmountPerQuantity"&&(e+=i||r.Markup),n.MarkupType==="Percentage"&&(f+=i||r.Markup),n.MarkupType==="AmountTotal"&&(u+=i||r.Markup)}},r,c;if(o&&angular.forEach(o.Specs,s),angular.forEach(n.Specs,s),angular.forEach(h.PriceBreaks,function(t){n.Quantity>=t.Quantity&&(i=t)}),!i){n.LineTotal=0;return}r=n.Quantity*(i.Price+e),r+=n.Quantity*i.Price*(f/100),r+=u,c="line total debug:\rquantity:"+n.Quantity+" & amount added per quantity:"+e+" & fixed ammount per line added:"+u+" & percentage added to qty*unitprice:"+f+" & unit price:"+i.Price,n.LineTotal=r,n.UnitPrice=i.Price}function e(r){r.lineItemErrors=[],r.$watch("LineItem",function(){r.setAddToOrderErrors()},!0),r.$watch("variantLineItems",function(){r.setAddToOrderErrors()},!0),r.setAddToOrderErrors=function(){var n=[],i,t;r.allowAddFromVariantList?(i=!1,t=!1,angular.forEach(r.variantLineItems,function(r){r.Quantity>0&&(i=!0),r.qtyError&&!t&&(n.push(r.qtyError),t=!0)}),r.LineItem.Product.Type!="VariableText"||Object.keys(r.variantLineItems).length?i||t||n.push("Please select a quantity"):n.push("Please create a variant.")):r.LineItem.Quantity||r.LineItem.qtyError||n.push("Please select a quantity."),r.LineItem.qtyError&&n.push(r.LineItem.qtyError),!r.LineItem.Variant&&r.LineItem.Product.IsVBOSS&&n.push("Please select an active product"),angular.forEach(r.LineItem.Specs,function(t){t.Required&&!t.Value&&n.push(t.Name+" is a required field")}),r.lineItemErrors=n},r.specChanged=function(n){if(console.log("spec changed"),n){if(r.variantLineItems){angular.forEach(r.variantLineItems,function(n){u(n)}),r.calcVariantLineItems();return}if(n.DefinesVariant){var e=[],o=!0;t.filter(r.LineItem.Specs,{Property:"DefinesVariant",Value:!0},function(n){if(!n.SelectedOptionID){o=!1;return}e.push(n.SelectedOptionID)}),o&&i.get({ProductInteropID:r.LineItem.Product.InteropID,SpecOptionIDs:e},function(n){n.IsDefaultVariant||(r.LineItem.Variant=n),f(r)},function(){r.LineItem.Variant=null})}u(r.LineItem)}},r.trustedDescription=function(t){if(t)return n.trustAsHtml(t.Description)},r.inventoryDisplay=function(n,t){var i=n.IsVariantLevelInventory?t:n;return i?i.QuantityAvailable>0?i.QuantityAvailable:0:null},r.StaticSpecGroups=r.LineItem.Variant?r.LineItem.Variant.StaticSpecGroups||r.LineItem.Product.StaticSpecGroups:r.LineItem.Product.StaticSpecGroups}function f(n){function r(n,t){if(!n.Variants)return!1;for(var i=0;i<n.Variants.length;i++)if(n.Variants[i][t])return!0;return!1}var i=!1,t;n.LineItem.Specs||(n.LineItem.Specs={},angular.forEach(n.LineItem.Product.Specs,function(t){(t.CanSetForLineItem||t.DefinesVariant)&&(i=!0,n.LineItem.Specs[t.Name]=t)})),n.allowAddFromVariantList=(n.LineItem.Product.ShowSpecsWithVariantList||!i)&&!n.LineItem.Variant&&n.LineItem.Product.Variants&&(n.LineItem.Product.Variants.length>0||n.LineItem.Product.Type=="VariableText"),n.LineItem.Variant?n.LineItem.PriceSchedule=n.LineItem.Variant.StandardPriceSchedule?n.LineItem.Variant.StandardPriceSchedule:n.LineItem.Product.StandardPriceSchedule:(n.LineItem.PriceSchedule=r(n.LineItem.Product,"StandardPriceSchedule")?null:n.LineItem.Product.StandardPriceSchedule,n.allowAddFromVariantList&&(t=n.LineItem.Product,n.variantLineItems={},angular.forEach(t.Variants,function(i){n.variantLineItems[i.InteropID]={PriceSchedule:i.StandardPriceSchedule||t.StandardPriceSchedule,Product:t,Variant:i,Specs:n.LineItem.Specs}}))),n.allowAddToOrder=n.allowAddFromVariantList||n.LineItem.Variant||n.LineItem.Product.VariantCount==0&&n.LineItem.Product.Type!="VariableText"}function o(n,t){return n.StaticSpecGroups?n.StaticSpecGroups.SPAProductConfig?n.StaticSpecGroups.SPAProductConfig.Specs[t]?n.StaticSpecGroups.SPAProductConfig.Specs[t].Value||escapeNull:null:null:null}function s(n,u,f){r.get(n,function(n){var r=n,e;u?r.Type=="VariableText"?i.get({VariantInteropID:u,ProductInteropID:r.InteropID},function(n){f({product:r,variant:n})}):(e=t.filter(n.Variants,{Property:"InteropID",Value:u})[0],f({product:r,variant:e})):f({product:r})})}return{getProductAndVariant:s,setNewLineItemScope:function(n){f(n)},setProductViewScope:function(n){e(n)},calculateLineTotal:function(n){return u(n)},getStaticSpecSPAConfig:function(n,t){return o(n,t)}}}]),four51.app.factory("Order",["$resource","$rootScope","$451","Security","Error",function(n,t,i,r,u){function f(n,i){angular.isFunction(n)&&n(i),t.$broadcast("event:orderUpdate",i)}function e(n){n.isEditable=n.Status=="Unsubmitted"||n.Status=="Open",angular.forEach(n.LineItems,function(n){n.OriginalQuantity=n.Quantity,angular.forEach(n.Specs,function(n){n.ControlType=="File"&&n.File&&n.File.Url.indexOf("auth")==-1&&(n.File.Url+="&auth="+r.auth())}),n.SpecsLength=Object.keys(n.Specs).length}),n.IsMultipleShip=function(){var t=!1;return angular.forEach(n.LineItems,function(i,r){t=t||r>0?i.ShipAddressID!=n.LineItems[r-1].ShipAddressID||i.ShipperID!=n.LineItems[r-1].ShipperID||i.ShipFirstName!=n.LineItems[r-1].ShipFirstName&&n.LineItems[r-1].ShipLastName!=n.ShipLastName:!1}),t}}var o=function(t,r){var u=store.get("451Cache.Order."+t);u?function(){e(u),f(r,u)}():n(i.api("order")).get({id:t}).$promise.then(function(n){e(n),store.set("451Cache.Order."+t,n),f(r,n)})},s=function(t,r,o){n(i.api("order")).save(t).$promise.then(function(n){store.set("451Cache.Order."+n.ID,n),e(n),f(r,n)},function(n){o(u.format(n))})},h=function(t,r,e){n(i.api("order")).delete().$promise.then(function(){store.remove("451Cache.Order."+t.ID),f(r)},function(n){e(u.format(n))})},c=function(t,r,o){n(i.api("order"),{},{submit:{method:"PUT"}}).submit(t).$promise.then(function(n){store.set("451Cache.Order."+n.ID),e(n),f(r,n)},function(n){o(u.format(n))})};return{get:o,save:s,"delete":h,submit:c}}]),four51.app.factory("OrderConfig",function(){function e(){return n.ShipAddressID!=null?!0:(angular.forEach(n.LineItems,function(n){if(n.ShipAddressID!=null)return!0}),!1)}var t,n,i=function(){t.CostCenters.length==1&&n.CostCenter==null&&(n.CostCenter=t.CostCenters[0].Name,angular.forEach(n.LineItems,function(n){n.CostCenter=t.CostCenters[0].Name}))},r=function(i){if(t.Permissions.contains("SubmitForApproval")&&n.Approvals.length>0){n.PaymentMethod="Undetermined";return}if(t.Permissions.contains("PayByBudgetAccount")&&i.length>0){n.PaymentMethod="BudgetAccount";return}if(t.Permissions.contains("PayByCreditCard")&&t.AvailableCreditCards.length>0){n.PaymentMethod="CreditCard";return}if(t.Permissions.contains("PayByPO")){n.PaymentMethod="PurchaseOrder";return}return n.PaymentMethod=="Undetermined"&&n.Approvals.length==0&&(n.PaymentMethod=null),null},u=function(){angular.forEach(t.CostCenters,function(t){t.DefaultAddressID&&(n.CostCenter&&(n.ShipAddressID=n.ShipAddressID||n.CostCenter==t.Name?t.DefaultAddressID:null),angular.forEach(n.LineItems,function(n){n.CostCenter&&(n.ShipAddressID=n.ShipAddressID||n.CostCenter==t.Name?t.DefaultAddressID:null)}))})},f=function(){return t.Permissions.contains("EditPOID")||t.Permissions.contains("Comments")||t.Permissions.contains("CostCenterPerOrder")&&!t.Permissions.contains("CostCenterPerLine")||n.OrderFields.length>0};return{address:function(i,r){return n=i,t=r,e()||u(),this},costcenter:function(r,u){return n=r,t=u,n.Status=="Unsubmitted"&&i(),this},paymentMethod:function(i,u,f){return n=i,t=u,n.PaymentMethod=="Undetermined"&&r(f),this},hasConfig:function(i,r){return n=i,t=r,f()}}}),four51.app.factory("OrderSearch",["$resource","$451",function(n,t){var i=function(i,r){n(t.api("order"),{},{get:{method:"GET",isArray:!0}}).get(i).$promise.then(function(n){angular.isFunction(r)&&r(n)})};return{search:i}}]),four51.app.factory("OrderSearchCriteria",["$resource","$http","$451",function(n,t,i){var r=function(t){n(i.api("orderstats")).query().$promise.then(function(n){angular.isFunction(t)&&t(n)})};return{query:r}}]),four51.app.factory("Product",["$resource","$451","Security",function(n,t,i){function r(n,t){angular.isFunction(n)&&n(t)}function u(n){n.ViewName=n.ViewName||"default",angular.forEach(n.Specs,function(n){n.ControlType=="File"&&n.File&&n.File.Url.indexOf("auth")==-1&&(n.File.Url+="&auth="+i.auth())}),angular.forEach(n.StaticSpecGroups,function(n){angular.forEach(n.Specs,function(n){n.FileURL&&n.FileURL.indexOf("auth")==-1&&(n.FileURL+="&auth="+i.auth())})}),n.StaticSpecGroups&&(n.StaticSpecLength=0,n.StaticSpecGroups.EvenSpecGroups=[],n.StaticSpecGroups.OddSpecGroups=[],angular.forEach(n.StaticSpecGroups,function(t){var i=!1,r;for(r in t.Specs)t.Specs[r].VisibleToCustomer&&(i=!0);i&&(n.StaticSpecGroups.EvenSpecGroups.length==n.StaticSpecGroups.OddSpecGroups.length?n.StaticSpecGroups.EvenSpecGroups.push(t):n.StaticSpecGroups.OddSpecGroups.push(t),n.StaticSpecLength++)}))}var f=function(i,f){var e=n(t.api("Products/:interopID"),{interopID:"@ID"}).get({interopID:i}).$promise.then(function(n){u(n),r(f,n)})},e=function(i,f,e,o){if(!i&&!f&&!e)return null;var s={CategoryInteropID:i,SearchTerms:f?f:"",RelatedProductGroupID:e},h=n(t.api("Products")).query(s).$promise.then(function(n){angular.forEach(n,u),r(o,n)})};return{get:f,search:e}}]),four51.app.factory("Variant",["$resource","$451","Security",function(n,t,i){function r(n,t){angular.isFunction(n)&&n(t)}function u(n){angular.forEach(n.Specs,function(n){n.ControlType=="File"&&n.File&&n.File.Url.indexOf("auth")==-1&&(n.File.Url+="&auth="+i.auth())})}var f=function(i,f,e){n(t.api("variant")).get(i).$promise.then(function(n){u(n),r(f,n)},function(n){e(n)})},e=function(i,f){return n(t.api("variant")).save(i).$promise.then(function(n){var t={ProductInteropID:n.ProductInteropID,VariantInteropID:n.InteropID};u(n),r(f,n)})};return{get:f,save:e}}]),four51.app.factory("Category",["$resource","$451",function(n,t){function i(n,t){angular.isFunction(n)&&n(t)}var u=function(r,u){var f=store.get("451Cache.Category."+r);f?i(u,f):n(t.api("categories/:interopID",{interopID:"@ID"})).get({interopID:r}).$promise.then(function(n){store.set("451Cache.Category."+n.InteropID,n),i(u,n)})},r="451Cache.Tree."+t.apiName,f=function(u){var f=store.get(r);f?i(u,f):n(t.api("categories"),{},{query:{method:"GET",isArray:!0}}).query().$promise.then(function(n){store.set(r,n),i(u,n)})};return{tree:f,get:u}}]),four51.app.factory("Message",["$resource","$451",function(n,t){function i(n,t){angular.isFunction(n)&&n(t)}var r=function(r,u){var f=store.get("451Cache.Message."+r);f?i(u,f):n(t.api("message/:id"),{id:"@id"}).get({id:r}).$promise.then(function(n){store.set("451Cache.Message."+n.ID,n),i(u,n)})},u=function(r,u){n(t.api("message")).delete(r,function(){store.remove("451Cache.Messages"),store.remove("451Cache.Message."+r.ID),i(u)})},f=function(r,u){n(t.api("message")).save(r).$promise.then(function(n){store.remove("451Cache.Messages"),store.set("451Cache.Message."+n.ID,n),i(u,n)})};return{get:r,"delete":u,save:f}}]),four51.app.factory("MessageList",["$q","$resource","$451",function(n,t,i){function r(n,t){angular.isFunction(n)&&n(t)}var u=function(n){var u=store.get("451Cache.Messages");u?r(n,u):t(i.api("message")).query().$promise.then(function(t){store.set("451Cache.Messages",t),r(n,t)})},f=function(u,f){store.remove("451Cache.Messages");var e=[];angular.forEach(u,function(r){r.Selected&&e.push(function(){var u=n.defer();return t(i.api("message")).delete(r).$promise.then(function(){u.resolve()}),u.promise}())}),n.all(e).then(function(){r(f)})};return{query:u,"delete":f}}]),four51.app.factory("FavoriteOrder",["$q","$resource","$451",function(n,t,i){function u(n,t){angular.isFunction(n)&&n(t)}var r="451Cache.FavoriteOrders."+i.apiName,f=function(n){var f=store.get(r);f?u(n,f):t(i.api("favoriteorder"),{},{isArray:!0}).query(function(t){store.set(r,t),u(n,t)})},e=function(n,f){store.remove(r),store.remove("451Cache.Order."+n.ID),t(i.api("favoriteorder"),{},{save:{method:"POST",isArray:!0}}).save(n).$promise.then(function(n){store.set(r,n),u(f,n)})},o=function(f,e){store.remove(r);var o=[];angular.forEach(f,function(r){r.Selected&&o.push(function(){var u=n.defer();return t(i.api("favoriteorder")).delete(r).$promise.then(function(){u.resolve()}),u.promise}())}),n.all(o).then(function(){u(e)})};return{query:f,save:e,"delete":o}}]),four51.app.factory("SpendingAccount",["$resource","$rootScope","$451",function(n,t,i){function r(n,i){angular.isFunction(n)&&(n(i),t.$broadcast("event:SpendingAccountUpdate",i))}function u(n){angular.forEach(n,function(n){n.ForPurchase=n.AccountType.PurchaseCredit})}var f=function(t){return n(i.api("spendingaccount")).query().$promise.then(function(n){u(n),console.log(n),r(t,n)})};return{query:f}}]),four51.app.factory("Address",["$resource","$451","Error",function(n,t,i){function r(n,t){angular.isFunction(n)&&n(t)}function u(){}var f=function(i,f){var e=store.get("451Cache.Address."+i);e?function(){u(e),r(f,e)}():n(t.api("address/:id"),{id:"@id"}).get({id:i}).$promise.then(function(n){store.set("451Cache.Address."+i,n),u(n),r(f,n)})},e=function(f,e,o){return n(t.api("address")).save(f).$promise.then(function(n){store.remove("451Cache.Addresses"),store.set("451Cache.Address."+n.ID,n),u(n),r(e,n)},function(n){o(i.format(n))})},o=function(i,u){return n(t.api("address")).delete(i).$promise.then(function(){store.remove("451Cache.Addresses"),store.remove("451Cache.Address."+i.ID),r(u)})};return{get:f,save:e,"delete":o}}]),four51.app.factory("AddressList",["$q","$resource","$451",function(n,t,i){function r(n,t){angular.isFunction(n)&&n(t)}var u=function(n){var u=store.get("451Cache.Addresses");u?r(n,u):t(i.api("address")).query().$promise.then(function(t){store.set("451Cache.Addresses",t),r(n,t)})},f=function(u,f){store.remove("451Cache.Addresses");var e=[];angular.forEach(u,function(r){r.Selected&&e.push(function(){var u=n.defer();return t(i.api("address")).delete(r).$promise.then(function(){u.resolve()}),u.promise}())}),n.all(e).then(function(){r(f)})};return{query:u,"delete":f}}]),four51.app.factory("Shipper",["$resource","$451",function(n,t){function i(n,t){angular.isFunction(n)&&n(t)}var r=function(r,u){if(!r)return null;n(t.api("shipper")).query().$promise.then(function(n){i(u,n)})};return{query:r}}]),four51.app.factory("Coupon",["$resource","$451","Error",function(n,t,i){function r(n,t){angular.isFunction(n)&&n(t)}var u=function(u,f,e){return n(t.api("coupon")).save({CouponCode:u}).$promise.then(function(n){r(f,n)},function(n){e(i.format(n))})},f=function(i){return n(t.api("coupon")).delete().$promise.then(function(){r(i)})};return{apply:u,remove:f}}]),four51.app.factory("GiftCard",["$resource","$451","Error",function(n,t,i){function r(n,t){angular.isFunction(n)&&n(t)}var u=function(u,f,e){return n(t.api("giftcard")).save(u).$promise.then(function(n){r(f,n)},function(n){e(i.format(n))})};return{redeem:u}}]),four51.app.factory("SavedCreditCard",["$resource","$rootScope","$451",function(n,t,i){function r(n,t){angular.isFunction(n)&&n(t)}var u=function(t){var u=store.get("451Cache.SavedCards");u?r(t,u):n(i.api("savedcreditcard")).query().$promise.then(function(n){store.set("451Cache.SavedCards",n),r(t,n)})},f=function(t,u){n(i.api("savedcreditcard")).delete(t,function(){store.remove("451Cache.SavedCards"),r(u)})};return{query:u,"delete":f}}]),four51.app.factory("Resources",function(){var n=[{label:"United States of America",value:"US"},{label:"Afghanistan",value:"AF"},{label:"Åland Islands",value:"AX"},{label:"Albania",value:"AL"},{label:"Algeria",value:"DZ"},{label:"American Samoa",value:"AS"},{label:"Andorra",value:"AD"},{label:"Angola",value:"AO"},{label:"Anguilla",value:"AI"},{label:"Antarctica",value:"AQ"},{label:"Antigua and Barbuda",value:"AG"},{label:"Argentina",value:"AR"},{label:"Armenia",value:"AM"},{label:"Aruba",value:"AW"},{label:"Australia",value:"AU"},{label:"Austria",value:"AT"},{label:"Azerbaijan",value:"AZ"},{label:"Bahamas",value:"BS"},{label:"Bahrain",value:"BH"},{label:"Bangladesh",value:"BD"},{label:"Barbados",value:"BB"},{label:"Belarus",value:"BY"},{label:"Belgium",value:"BE"},{label:"Belize",value:"BZ"},{label:"Benin",value:"BJ"},{label:"Bermuda",value:"BM"},{label:"Bhutan",value:"BT"},{label:"Bolivia",value:"BO"},{label:"Bosnia and Herzegovina",value:"BA"},{label:"Botswana",value:"BW"},{label:"Bouvet Island",value:"BV"},{label:"Brazil",value:"BR"},{label:"British Indian Ocean Territory",value:"IO"},{label:"Brunei Darussalam",value:"BN"},{label:"Bulgaria",value:"BG"},{label:"Burkina Faso",value:"BF"},{label:"Burundi",value:"BI"},{label:"Cambodia",value:"KH"},{label:"Cameroon",value:"CM"},{label:"Canada",value:"CA"},{label:"Cape Verde",value:"CV"},{label:"Cayman Islands",value:"KY"},{label:"Central African Republic",value:"CF"},{label:"Chad",value:"TD"},{label:"Chile",value:"CL"},{label:"China",value:"CN"},{label:"Christmas Island Australia",value:"CX"},{label:"Cocos Keeling Islands",value:"CC"},{label:"Colombia",value:"CO"},{label:"Comoros",value:"KM"},{label:"Congo",value:"CG"},{label:"Congo, D.R.",value:"CD"},{label:"Cook Islands",value:"CK"},{label:"Costa Rica",value:"CR"},{label:"Cote D'Ivoire Ivory Coast",value:"CI"},{label:"Croatia Hrvatska",value:"HR"},{label:"Cuba",value:"CU"},{label:"Cyprus",value:"CY"},{label:"Czech Republic",value:"CZ"},{label:"Denmark",value:"DK"},{label:"Djibouti",value:"DJ"},{label:"Dominica",value:"DM"},{label:"Dominican Republic",value:"DO"},{label:"Ecuador",value:"EC"},{label:"Egypt",value:"EG"},{label:"El Salvador",value:"SV"},{label:"Equatorial Guinea",value:"GQ"},{label:"Eritrea",value:"ER"},{label:"Estonia",value:"EE"},{label:"Ethiopia",value:"ET"},{label:"Faeroe Islands",value:"FO"},{label:"Falkland Islands Malvinas",value:"FK"},{label:"Fiji",value:"FJ"},{label:"Finland",value:"FI"},{label:"France",value:"FR"},{label:"France, Metropolitan",value:"FX"},{label:"French Guiana",value:"GF"},{label:"French Polynesia",value:"PF"},{label:"French Southern Territories",value:"TF"},{label:"Gabon",value:"GA"},{label:"Gambia",value:"GM"},{label:"Georgia",value:"GE"},{label:"Germany",value:"DE"},{label:"Ghana",value:"GH"},{label:"Gibraltar",value:"GI"},{label:"Greece",value:"GR"},{label:"Greenland",value:"GL"},{label:"Grenada",value:"GD"},{label:"Guadeloupe",value:"GP"},{label:"Guam",value:"GU"},{label:"Guatemala",value:"GT"},{label:"Guinea",value:"GN"},{label:"Guinea Bissau",value:"GW"},{label:"Guyana",value:"GY"},{label:"Haiti",value:"HT"},{label:"Heard and McDonald Is.",value:"HM"},{label:"Honduras",value:"HN"},{label:"Hong Kong",value:"HK"},{label:"Hungary",value:"HU"},{label:"Iceland",value:"IS"},{label:"India",value:"IN"},{label:"Indonesia",value:"ID"},{label:"Iran",value:"IR"},{label:"Iraq",value:"IQ"},{label:"Isle of Man",value:"IM"},{label:"Ireland",value:"IE"},{label:"Israel",value:"IL"},{label:"Italy",value:"IT"},{label:"Jamaica",value:"JM"},{label:"Japan",value:"JP"},{label:"Jersey",value:"JE"},{label:"Jordan",value:"JO"},{label:"Kazakhstan",value:"KZ"},{label:"Kenya",value:"KE"},{label:"Kiribati",value:"KI"},{label:"Korea North",value:"KP"},{label:"Korea South",value:"KR"},{label:"Kuwait",value:"KW"},{label:"Kyrgyzstan",value:"KG"},{label:"Lao P.Dem.R.",value:"LA"},{label:"Latvia",value:"LV"},{label:"Lebanon",value:"LB"},{label:"Lesotho",value:"LS"},{label:"Liberia",value:"LR"},{label:"Libyan Arab Jamahiriya",value:"LY"},{label:"Liechtenstein",value:"LI"},{label:"Lithuania",value:"LT"},{label:"Luxembourg",value:"LU"},{label:"Macau",value:"MO"},{label:"Macedonia",value:"MK"},{label:"Madagascar",value:"MG"},{label:"Malawi",value:"MW"},{label:"Malaysia",value:"MY"},{label:"Maldives",value:"MV"},{label:"Mali",value:"ML"},{label:"Malta",value:"MT"},{label:"Marshall Islands",value:"MH"},{label:"Martinique",value:"MQ"},{label:"Mauritania",value:"MR"},{label:"Mauritius",value:"MU"},{label:"Mayotte",value:"YT"},{label:"Mexico",value:"MX"},{label:"Micronesia",value:"FM"},{label:"Moldova",value:"MD"},{label:"Monaco",value:"MC"},{label:"Mongolia",value:"MN"},{label:"Montenegro",value:"ME"},{label:"Montserrat",value:"MS"},{label:"Morocco",value:"MA"},{label:"Mozambique",value:"MZ"},{label:"Myanmar",value:"MM"},{label:"Namibia",value:"NA"},{label:"Nauru",value:"NR"},{label:"Nepal",value:"NP"},{label:"Netherlands",value:"NL"},{label:"Netherlands Antilles",value:"AN"},{label:"New Caledonia",value:"NC"},{label:"New Zealand",value:"NZ"},{label:"Nicaragua",value:"NI"},{label:"Niger",value:"NE"},{label:"Nigeria",value:"NG"},{label:"Niue",value:"NU"},{label:"Norfolk Island",value:"NF"},{label:"Northern Mariana Islands",value:"MP"},{label:"Norway",value:"NO"},{label:"Oman",value:"OM"},{label:"Pakistan",value:"PK"},{label:"Palau",value:"PW"},{label:"Palestinian Territory, Occupied",value:"PS"},{label:"Panama",value:"PA"},{label:"Papua New Guinea",value:"PG"},{label:"Paraguay",value:"PY"},{label:"Peru",value:"PE"},{label:"Philippines",value:"PH"},{label:"Pitcairn",value:"PN"},{label:"Poland",value:"PL"},{label:"Portugal",value:"PT"},{label:"Puerto Rico",value:"PR"},{label:"Qatar",value:"QA"},{label:"Reunion",value:"RE"},{label:"Romania",value:"RO"},{label:"Russian Federation",value:"RU"},{label:"Rwanda",value:"RW"},{label:"Saint Helena",value:"SH"},{label:"Saint Kitts and Nevis",value:"KN"},{label:"Saint Lucia",value:"LC"},{label:"Saint Pierre and Miquelon",value:"PM"},{label:"Saint Vincent and the Grenadines",value:"VC"},{label:"Samoa",value:"WS"},{label:"San Marino",value:"SM"},{label:"Sao Tome and Principe",value:"ST"},{label:"Saudi Arabia",value:"SA"},{label:"Senegal",value:"SN"},{label:"Serbia",value:"RS"},{label:"Seychelles",value:"SC"},{label:"Sierra Leone",value:"SL"},{label:"Singapore",value:"SG"},{label:"Slovakia",value:"SK"},{label:"Slovenia",value:"SI"},{label:"Solomon Islands",value:"SB"},{label:"Somalia",value:"SO"},{label:"South Africa",value:"ZA"},{label:"S. Georgia &amp; S. Sandwich Is.",value:"GS"},{label:"Spain",value:"ES"},{label:"Sri Lanka",value:"LK"},{label:"Sudan",value:"SD"},{label:"Suriname",value:"SR"},{label:"Svalbard &amp; Jan Mayen Is.",value:"SJ"},{label:"Swaziland",value:"SZ"},{label:"Sweden",value:"SE"},{label:"Switzerland",value:"CH"},{label:"Syrian Arab Rep.",value:"SY"},{label:"Taiwan",value:"TW"},{label:"Tajikistan",value:"TJ"},{label:"Tanzania",value:"TZ"},{label:"Thailand",value:"TH"},{label:"Timor-Leste",value:"TG"},{label:"Togo",value:"TG"},{label:"Tokelau",value:"TK"},{label:"Tonga",value:"TO"},{label:"Trinidad and Tobago",value:"TT"},{label:"Tunisia",value:"TN"},{label:"Turkey",value:"TR"},{label:"Turkmenistan",value:"TM"},{label:"Turks and Caicos Islands",value:"TC"},{label:"Tuvalu",value:"TU"},{label:"Uganda",value:"UG"},{label:"Ukraine",value:"UA"},{label:"United Kingdom",value:"GB"},{label:"United Arab Emirates",value:"AE"},{label:"US Minor Outlying Is.",value:"UM"},{label:"Uruguay",value:"UY"},{label:"Uzbekistan",value:"UZ"},{label:"Vanuatu",value:"VU"},{label:"Vatican City State",value:"VC"},{label:"Venezuela",value:"VE"},{label:"Viet Nam",value:"VN"},{label:"Virgin Islands British",value:"VG"},{label:"Virgin Islands US",value:"VI"},{label:"Wallis and Futuna Islnds",value:"WF"},{label:"Western Sahara",value:"EH"},{label:"Yemen",value:"YE"},{label:"Yugoslavia",value:"YU"},{label:"Zambia",value:"ZM"},{label:"Zimbabwe",value:"ZW"}],t=[{label:"Alabama",value:"AL",country:"US"},{label:"Alaska",value:"AK",country:"US"},{label:"Arizona",value:"AZ",country:"US"},{label:"Arkansas",value:"AR",country:"US"},{label:"California",value:"CA",country:"US"},{label:"Colorado",value:"CO",country:"US"},{label:"Connecticut",value:"CT",country:"US"},{label:"Delaware",value:"DE",country:"US"},{label:"District of Columbia",value:"DC",country:"US"},{label:"Florida",value:"FL",country:"US"},{label:"Georgia",value:"GA",country:"US"},{label:"Hawaii",value:"HI",country:"US"},{label:"Idaho",value:"ID",country:"US"},{label:"Illinois",value:"IL",country:"US"},{label:"Indiana",value:"IN",country:"US"},{label:"Iowa",value:"IA",country:"US"},{label:"Kansas",value:"KS",country:"US"},{label:"Kentucky",value:"KY",country:"US"},{label:"Louisiana",value:"LA",country:"US"},{label:"Maine",value:"ME",country:"US"},{label:"Maryland",value:"MD",country:"US"},{label:"Massachusetts",value:"MA",country:"US"},{label:"Michigan",value:"MI",country:"US"},{label:"Minnesota",value:"MN",country:"US"},{label:"Mississippi",value:"MS",country:"US"},{label:"Missouri",value:"MO",country:"US"},{label:"Montana",value:"MT",country:"US"},{label:"Nebraska",value:"NE",country:"US"},{label:"Nevada",value:"NV",country:"US"},{label:"New Hampshire",value:"NH",country:"US"},{label:"New Jersey",value:"NJ",country:"US"},{label:"New Mexico",value:"NM",country:"US"},{label:"New York",value:"NY",country:"US"},{label:"North Carolina",value:"NC",country:"US"},{label:"North Dakota",value:"ND",country:"US"},{label:"Ohio",value:"OH",country:"US"},{label:"Oklahoma",value:"OK",country:"US"},{label:"Oregon",value:"OR",country:"US"},{label:"Pennsylvania",value:"PA",country:"US"},{label:"Rhode Island",value:"RI",country:"US"},{label:"South Carolina",value:"SC",country:"US"},{label:"South Dakota",value:"SD",country:"US"},{label:"Tennessee",value:"TN",country:"US"},{label:"Texas",value:"TX",country:"US"},{label:"Utah",value:"UT",country:"US"},{label:"Vermont",value:"VT",country:"US"},{label:"Virginia",value:"VA",country:"US"},{label:"Washington",value:"WA",country:"US"},{label:"West Virginia",value:"WV",country:"US"},{label:"Wisconsin",value:"WI",country:"US"},{label:"Wyoming",value:"WY",country:"US"},{label:"Armed Forces Americas (AA)",value:"AA",country:"US"},{label:"Armed Forces Africa/Canada/Europe/Middle East (AE)",value:"AE",country:"US"},{label:"Armed Forces Pacific (AP)",value:"AP",country:"US"},{label:"American Samoa",value:"AS",country:"US"},{label:"Federated States of Micronesia",value:"FM",country:"US"},{label:"Guam",value:"GU",country:"US"},{label:"Marshall Islands",value:"MH",country:"US"},{label:"Northern Mariana Islands",value:"MP",country:"US"},{label:"Palau",value:"PW",country:"US"},{label:"Puerto Rico",value:"PR",country:"US"},{label:"Virgin Islands",value:"VI",country:"US"},{label:"Drenthe",value:"Drenthe",country:"NL"},{label:"Flevoland",value:"Flevoland",country:"NL"},{label:"Friesland",value:"Friesland",country:"NL"},{label:"Gelderland",value:"Gelderland",country:"NL"},{label:"Groningen",value:"Groningen",country:"NL"},{label:"Limburg",value:"Limburg",country:"NL"},{label:"Noord-Brabant",value:"Noord-Brabant",country:"NL"},{label:"Noord-Holland",value:"Noord-Holland",country:"NL"},{label:"Overijssel",value:"Overijssel",country:"NL"},{label:"Utrecht",value:"Utrecht",country:"NL"},{label:"Zeeland",value:"Zeeland",country:"NL"},{label:"Zuid-Holland",value:"Zuid-Holland",country:"NL"},{label:"Alberta",value:"AB",country:"CA"},{label:"British Columbia",value:"BC",country:"CA"},{label:"Manitoba",value:"MB",country:"CA"},{label:"New Brunswick",value:"NB",country:"CA"},{label:"Newfoundland and Labrador",value:"NL",country:"CA"},{label:"Northwest Territories",value:"NT",country:"CA"},{label:"Nova Scotia",value:"NS",country:"CA"},{label:"Nunavut",value:"NU",country:"CA"},{label:"Ontario",value:"ON",country:"CA"},{label:"Prince Edward Island",value:"PE",country:"CA"},{label:"Quebec",value:"QC",country:"CA"},{label:"Saskatchewan",value:"SK",country:"CA"},{label:"Yukon",value:"YT",country:"CA"}];return{countries:n,states:t}}),four51.app.factory("SavedReports",["$resource","$451",function(n,t){function i(n,t){angular.isFunction(n)&&n(t)}function r(n){switch(n.ReportType){}n.AvailableTypes={LineItem:"Line Item",Order:"Order"},n.ColumnOptions&&(n.ColumnOptionsLength=Object.keys(n.ColumnOptions).length)}var u=function(u){var f=store.get("451Cache.SavedReports");f?function(){r(f),i(u,f)}():n(t.api("savedreports")).query().$promise.then(function(n){store.set("451Cache.SavedReports",n),r(n),i(u,n)})},f=function(u,f){n(t.api("savedreports/:id"),{id:"@id"}).get({id:u}).$promise.then(function(n){r(n),i(f,n)})};return{query:u,get:f}}]),four51.app.factory("Analytics",["$analytics",function(n){var t=function(t){n.eventTrack("ecommerce:addTransaction",{id:t.ExternalID,affiliation:$scope.user.Company.Name,revenue:t.Total,shipping:t.ShippingCost,tax:t.TaxCost}),angular.forEach(t.LineItems,function(i){n.eventTrack("ecommerce:addItem",{id:t.ExternalID,name:i.Product.Name,sku:i.Product.InteropID,price:i.UnitPrice,quantity:i.Quantity})}),n.eventTrack("ecommerce:send",{})};return{trackOrder:t}}]),four51.app.factory("Nav",function(){var n={visible:!0},t=function(){n.visible=!n.visible};return{status:n,toggle:t}}),four51.app.factory("fileReader",["$q",function(n){var t=function(n,t,i){return function(){i.$apply(function(){t.resolve(n)})}},i=function(n,t,i){return function(){i.$apply(function(){t.reject(n)})}},r=function(n,t){return function(n){t.$broadcast("fileProgress",{total:n.total,loaded:n.loaded})}},u=function(n,u){var f=new FileReader;return f.onload=t(f,n,u),f.onerror=i(f,n,u),f.onprogress=r(f,u),f},f=function(t,i){var r=n.defer(),f=u(r,i);return f.readAsDataURL(t),r.promise};return{readAsDataUrl:f}}]),four51.app.directive("ngMatch",["$parse",function(n){return{restrict:"A",require:"?ngModel",link:function(t,i,r,u){if(u&&r.ngMatch){var e=n(r.ngMatch),f=function(n){var i=e(t),r=n===i;return u.$setValidity("match",r),n};u.$parsers.unshift(f),u.$formatters.push(f),r.$observe("ngMatch",function(){f(u.$viewValue)})}}}}]),four51.app.directive("redirect",["$location",function(n){return{restrict:"A",link:function(t,i,r){r.$observe("redirect",function(){i.on("click",function(){t.$apply(function(){n.path(r.redirect)})})})}}}]),four51.app.directive("shortproductview",function(){return{restrict:"E",scope:{p:"=",user:"="},templateUrl:"partials/shortProductView.html",controller:"shortProductViewCtrl"}}),four51.app.directive("relatedproducts",function(){return{scope:{relatedgroupid:"="},restrict:"E",templateUrl:"partials/relatedProductsView.html",controller:"RelatedProductsCtrl"}}),four51.app.directive("pricescheduletable",function(){return{scope:{ps:"=",p:"="},restrict:"E",templateUrl:"partials/priceScheduleView.html"}}),four51.app.directive("staticspecstable",function(){return{scope:{specgroups:"=",length:"="},restrict:"E",templateUrl:"partials/controls/staticSpecs.html",controller:["$scope",function(n){n.hasvisiblechild=function(n){var t=!1;return angular.forEach(n,function(n){n.VisibleToCustomer&&(t=!0)}),t}}]}}),four51.app.directive("productnav",function(){return{scope:{product:"=",variant:"=",editvariant:"="},restrict:"E",templateUrl:"partials/controls/productNav.html"}}),four51.app.directive("variantlist",function(){return{restrict:"E",templateUrl:"partials/controls/variantList.html"}}),four51.app.directive("quantityfield",["$451","ProductDisplayService",function(n,t){return{scope:{lineitem:"=",calculated:"=",required:"="},restrict:"E",template:'<div><inlineerror ng-show="lineitem.qtyError" title="{{lineitem.qtyError}}" /><select id="451qa_input_qty" class="form-control" ng-change="qtyChanged(lineitem)" ng-if="lineitem.PriceSchedule.RestrictedQuantity" ng-required="required" ng-model="lineitem.Quantity" ng-options="pb.Quantity as getRestrictedQtyText(pb, lineitem.Product.QuantityMultiplier) for pb in lineitem.PriceSchedule.PriceBreaks" ui-validate="\'validQuantityAddToOrder($value, lineitem)\'"><option value=""><\/option><\/select><input id="451qa_input_qty" placeholder="0" autocomplete="off" class="form-control" ng-change="qtyChanged(lineitem)" ng-if="!lineitem.PriceSchedule.RestrictedQuantity" type="text" ng-required="required" name="qtyInput" ng-model="lineitem.Quantity" ui-validate="\'validQuantityAddToOrder($value, lineitem)\'"/><i class="fa fa-edit"><\/i><\/div>',link:function(i){i.getRestrictedQtyText=function(n,t){var i=n.Quantity*t;return t>1&&(i+=" ("+n.Quantity+"x"+t+")"),i},i.qtyChanged=function(n){t.calculateLineTotal(n),i.calculated&&i.calculated(n)},i.validQuantityAddToOrder=function(t,r){var e=r.Variant,f=r.Product,u=r.PriceSchedule,o;return t==""&&!i.required?(r.qtyError=null,i.valid|!0):t==null?(i.lineitem.qtyError=null,i.valid|!0):!f&&!e?i.valid|!0:u?(i.valid=!0,!n.isPositiveInteger(t))?(i.lineitem.qtyError="Please select a valid quantity",i.valid=!1):(u.MinQuantity>t&&(i.valid=!1,i.lineitem.qtyError="must be equal or greater than "+u.MinQuantity),u.MaxQuantity&&u.MaxQuantity<t&&(i.lineitem.qtyError="must be equal or less than "+u.MaxQuantity,i.valid=!1),f.IsVariantLevelInventory&&!e||(o=(f.IsVariantLevelInventory?e.QuantityAvailable:f.QuantityAvailable)+(r.OriginalQuantity||0),o<t&&f.AllowExceedInventory==!1&&(i.lineitem.qtyError="cannot exceed the Quantity Available of "+o,i.valid=!1)),i.valid&&(i.lineitem.qtyError=null),i.valid):i.valid|!0}}}}]),four51.app.directive("paymentselector",function(){return{restrict:"E",priority:99,templateUrl:"partials/controls/paymentSelection.html",controller:["$scope","$rootScope","SavedCreditCard",function(n,t,i){n.paymentSelection={},n.isSplitBilling=!1;var r=function(t){var i=null;return angular.forEach(n.paymentSelection.SavedCards,function(n){n.ID==t&&(i=n)}),i};n.setPaymentMethod=function(i){n.currentOrder.PaymentMethod=i,t.$broadcast("event:paymentMethodChange",i)},n.setBudgetAccount=function(t){(n.setPaymentMethod("BudgetAccount"),n.currentOrder.BudgetAccountID||t>1)||angular.forEach(n.SpendingAccounts,function(t){t.AccountType.PurchaseCredit&&(n.currentOrder.BudgetAccountID=t.ID,n.selectedBudgetAccount=t)})},t.$on("event:SpendingAccountUpdate",function(t,i){n.currentOrder&&n.currentOrder.PaymentMethod=="BudgetAccount"&&angular.forEach(i,function(t){n.selectedBudgetAccount||(n.currentOrder.BudgetAccountID==null&&t.AccountType.PurchaseCredit?(n.currentOrder.BudgetAccountID=t.ID,n.selectedBudgetAccount=t):t.AccountType.PurchaseCredit&&t.ID==n.currentOrder.BudgetAccountID&&(n.selectedBudgetAccount=t))})}),n.deleteSavedCard=function(t){if(confirm("Are you sure you wish to delete this saved credit card? This cannot be undone")==!0){var u=r(t);i.delete(u,function(){i.query(function(t){n.currentOrder.CreditCardID=null,n.paymentSelection.SavedCards=t})})}},n.showDelete=function(n){if(n==null)return!1;var t=r(n);return t.IsCustEditable},i.query(function(t){n.paymentSelection.SavedCards=t})}]}}),four51.app.directive("customtextfield",function(){return{scope:{customfield:"="},restrict:"E",transclude:!0,templateUrl:"partials/controls/customTextField.html",controller:["$scope",function(n){!n.customfield.Value&&n.customfield.DefaultValue&&(n.customfield.Value=n.customfield.DefaultValue)}]}}),four51.app.directive("customselectionfield",["$451",function(n){return{scope:{customfield:"=",change:"="},restrict:"E",transclude:!0,templateUrl:"partials/controls/customSelectionField.html",link:function(t){t.changed=function(){t.customfield.isOtherSelected=!1,angular.forEach(t.customfield.Options,function(n){n.Selected=!1}),t.customfield.Value=this.item==null?null:this.item.Value,t.customfield.SelectedOptionID=this.item==null?null:this.item.ID,this.item!=null&&(this.item.Selected=!0),this.item!=null&&this.item.Value.indexOf("Other")>-1&&(t.customfield.isOtherSelected=!0,this.item.Selected=!0,t.customfield.SelectedOptionID=this.item.ID,t.customfield.Value=t.other),t.change&&t.change(t.customfield)},t.otherChanged=function(){t.customfield.isOtherSelected=!0,t.customfield.Value=t.other,t.change&&t.change(t.customfield)},t.item={},t.other="",t.init=function(){var i=t.customfield.Value!=null?t.customfield.Options[t.customfield.Options.length-1].ID:t.customfield.DefaultOptionID,r=!1;angular.forEach(t.customfield.Options,function(u){r||(t.customfield.Value==u.Value&&(i=u.ID,r=!0),t.customfield.Value==null&&(i=t.customfield.DefaultOptionID,i!=null&&(t.customfield.Value=n.filter(t.customfield.Options,{Property:"ID",Value:i})[0].Value),r=!0))}),this.item=t.customfield.Value!=null?n.filter(t.customfield.Options,{Property:"ID",Value:i})[0]:null,this.item&&this.item.Value=="Other"&&(t.other=t.customfield.Value,this.otherChanged())}}}}]),four51.app.directive("approvalrulelist",function(){return{scope:{order:"="},restrict:"E",templateUrl:"partials/controls/approvalRuleSummary.html"}}),four51.app.directive("categorytree",function(){return{restrict:"E",replace:!0,scope:{tree:"="},templateUrl:"partials/categoryTree.html"}}),four51.app.directive("node",["$compile",function(n){return{restrict:"E",replace:!0,scope:{node:"="},template:'<li class="451_cat_item"><a ng-href="#/catalog/{{node.InteropID}}" ng-bind-html="node.Name"><\/a><\/li>',link:function(t,i){angular.isArray(t.node.SubCategories)&&(i.append("<categorytree tree='node.SubCategories' />"),n(i.contents())(t))}}}]),four51.app.directive("addressinput",function(){return{restrict:"E",scope:{address:"=","return":"=",user:"="},templateUrl:"partials/controls/addressInput.html",controller:"AddressInputCtrl"}}),four51.app.directive("orderhistorydetails",function(){return{restrict:"E",templateUrl:"partials/Reporting/orderHistoryDetailsView.html"}}),four51.app.directive("orderhistorysummary",function(){return{restrict:"E",templateUrl:"partials/Reporting/orderHistorySummaryView.html"}}),four51.app.directive("lineitemhistorygrid",function(){return{restrict:"E",templateUrl:"partials/Reporting/lineItemHistoryGridView.html"}}),four51.app.directive("lineitemreport",function(){return{restrict:"E",templateUrl:"partials/Reporting/lineItemReport.html",controller:["$scope",function(n){n.open=function(t,i){i.preventDefault(),i.stopPropagation(),n[t]=!0}}]}}),four51.app.directive("inlineerror",function(){return{restrict:"E",transclude:!0,scope:{title:"@"},template:'<p class="view-inline-error">{{title}}<\/p>',replace:!0}}),four51.app.directive("navigation",function(){return{restrict:"E",templateUrl:"partials/controls/nav.html",controller:"NavCtrl"}}),four51.app.directive("accountnavigation",function(){return{restrict:"E",templateUrl:"partials/controls/accountnav.html",controller:"NavCtrl"}}),four51.app.directive("backStep",function(){return{restrict:"A",link:function(n,t){t.bind("click",function(){history.back(),n.$apply()})}}}),four51.app.directive("branding",function(){return{restrict:"E",templateUrl:"partials/branding.html"}}),four51.app.directive("login",function(){return{restrict:"E",templateUrl:"partials/controls/login.html",controller:"LoginCtrl"}}),four51.app.directive("approval",function(){return{restrict:"E",scope:{order:"=order"},templateUrl:"partials/controls/approvalInput.html",controller:"ApprovalInputCtrl"}}),four51.app.directive("customfilefield",["$parse","$resource","$451","fileReader","Security",function(n,t,i,r,u){return{scope:{customfield:"=",replace:"@ngModel"},restrict:"E",templateUrl:"partials/controls/fileUpload.html",replace:!0,link:function(f,e){var s=angular.copy(f.customfield),v=n("file"),l=$(".replace",e)[0],h=$(".delete",e)[0],y=$(".upload",e)[0],a=$(".error",e)[0],p=function(n){f.uploadFileIndicator=!0,t(i.api("uploadfile")).save({Data:n.result,Name:y.files[0].name,ID:f.customfield.ID,SourceType:f.customfield.SourceType,SourceID:f.customfield.SourceID}).$promise.then(function(n){n.Url+="&auth="+u.auth(),f.customfield.File=n,f.customfield.Value=n.ID,f.uploadFileIndicator=!1}).catch(function(n){a.innerHTML=n.data.Message?n.data.Message:"An error occurred. Please select a new file and try again.",f.uploadFileIndicator=!1})},c=function(){f.$apply(function(){f.customfield=angular.copy(s)})},w=function(n){a.innerHTML="";switch(n.target.name){case"delete":if(f.replace=!1,n.target.checked){f.$apply(function(){f.customfield.File=null,f.customfield.Value=null,l.checked=!1});break}c();break;case"replace":h.checked&&(f.customfield=s,c(),h.checked=!1),!n.target.checked&&s.Value&&c();break;case"upload":if(n.target.files[0]==null)return;f.$apply(function(){r.readAsDataUrl(n.target.files[0],f).then(p),v.assign(f,n.target.files[0])}),f.replace=l.checked=!1,f.delete=h.checked=!1}};e.bind("change",w)}}}]),four51.app.directive("shortcartview",function(){return{restrict:"E",templateUrl:"partials/shortCartView.html"}}),four51.app.directive("loadingindicator",function(){return{restrict:"E",scope:{title:"@title"},templateUrl:"partials/controls/loadingIndicator.html"}}),four51.app.directive("alertShow",["$animate",function(n){return{scope:{alertShow:"="},link:function(t,i){t.$watch("alertShow",function(t){t&&(n.removeClass(i,"ng-hide"),n.addClass(i,"ng-hide"))})}}}]),four51.app.directive("giftcardredemption",function(){return{restrict:"E",templateUrl:"partials/controls/giftCardRedemption.html",controller:"GiftCardRedemptionCtrl"}}),four51.app.directive("copyright",function(){return{restrict:"E",templateUrl:"partials/copyrightView.html"}}),four51.app.directive("ordersummary",["Order","Coupon",function(n,t){return{restrict:"AE",templateUrl:"partials/controls/orderSummary.html",controller:["$scope",function(i){var r=function(t){n.save(i.currentOrder,function(n){i.currentOrder=n,t&&t(i.currentOrder)})};i.applyCoupon=function(){i.couponLoadingIndicator=!0,i.couponError=null,t.apply(i.currentOrder.CouponCode,function(n){i.currentOrder.Coupon=n,r(function(){i.couponLoadingIndicator=!1})},function(n){i.couponError=n.Message,i.couponLoadingIndicator=!1})},i.removeCoupon=function(){i.couponError=null,i.couponRemoveIndicator=!0,t.remove(function(){r(function(){i.couponRemoveIndicator=!1})})}}]}}]),four51.app.directive("orderdetails",function(){return{restrict:"AE",templateUrl:"partials/controls/orderDetails.html"}}),four51.app.directive("ordershipping",["Order","Shipper","Address","OrderConfig",function(n,t,i){return{restrict:"AE",templateUrl:"partials/controls/orderShipping.html",controller:["$scope",function(r){var u=function(t){r.errorMessage=null;var i=r.currentOrder.autoID;n.save(r.currentOrder,function(n){r.currentOrder=n,r.displayLoadingIndicator=!1,i&&(r.currentOrder.autoID=!0,r.currentOrder.ExternalID="auto"),t&&t(r.currentOrder)},function(n){r.currentOrder.ExternalID=null,r.errorMessage=n.Message,r.shippingUpdatingIndicator=!1,r.shippingFetchIndicator=!1})};t.query(r.currentOrder,function(n){r.shippers=n}),r.setMultipleShipAddress=function(){angular.forEach(r.currentOrder.LineItems,function(n,t){t!=0&&(n.ShipAddressID=null,n.ShipFirstName=null,n.ShipLastName=null,n.ShipperID=null,n.ShipperName=null)})},r.setSingleShipAddress=function(){angular.forEach(r.currentOrder.LineItems,function(n){n.ShipAddressID=r.currentOrder.LineItems[0].ShipAddressID,n.ShipFirstName=r.currentOrder.LineItems[0].ShipFirstName,n.ShipLastName=r.currentOrder.LineItems[0].ShipLastName,n.ShipperID=r.currentOrder.LineItems[0].ShipperID})},r.$watch("currentOrder.ShipAddressID",function(n){r.orderShipAddress={},r.currentOrder&&(r.currentOrder.ShipFirstName=null,r.currentOrder.ShipLastName=null,angular.forEach(r.currentOrder.LineItems,function(n){n.ShipFirstName=null,n.ShipLastName=null})),n&&i.get(n,function(n){r.user.Permissions.contains("EditShipToName")&&!n.IsCustEditable&&angular.forEach(r.currentOrder.LineItems,function(t){t.ShipFirstName=n.FirstName,t.ShipLastName=n.LastName}),r.orderShipAddress=n})}),r.setShipAddressAtLineItem=function(n){n.ShipFirstName=null,n.ShipLastName=null,u(function(n){t.query(n,function(n){r.shippers=n})})},r.setShipAddressAtOrderLevel=function(){r.shippingFetchIndicator=!0,r.currentOrder.ShipperName=null,r.currentOrder.Shipper=null,r.currentOrder.ShipperID=null,angular.forEach(r.currentOrder.LineItems,function(n){n.ShipAddressID=r.currentOrder.ShipAddressID,n.ShipFirstName=null,n.ShipLastName=null,n.ShipperName=null,n.Shipper=null,n.ShipperID=null}),u(function(n){t.query(n,function(n){r.shippers=n,r.shippingFetchIndicator=!1})})},r.updateShipper=function(n){r.shippingUpdatingIndicator=!0,r.shippingFetchIndicator=!0,n?(angular.forEach(r.shippers,function(t){t.Name==n.ShipperName&&(n.Shipper=t)}),n.ShipperName=n.Shipper.Name,n.ShipperID=n.Shipper.ID,u(function(){r.shippingUpdatingIndicator=!1,r.shippingFetchIndicator=!1})):(angular.forEach(r.shippers,function(n){n.Name==r.currentOrder.LineItems[0].ShipperName&&(r.currentOrder.Shipper=n)}),angular.forEach(r.currentOrder.LineItems,function(n){n.ShipperName=r.currentOrder.Shipper?r.currentOrder.Shipper.Name:null,n.ShipperID=r.currentOrder.Shipper?r.currentOrder.Shipper.ID:null}),u(function(){r.shippingUpdatingIndicator=!1,r.shippingFetchIndicator=!1}))},r.$on("event:AddressCancel",function(){r.addressform=!1})}]}}]),four51.app.directive("orderbilling",["SpendingAccount","Address",function(n,t){return{restrict:"AE",templateUrl:"partials/controls/orderBilling.html",controller:["$scope",function(i){function u(n){var r=function(){var n=null;return(angular.forEach(i.SpendingAccounts,function(t){i.currentOrder&&t.ID==i.currentOrder.BudgetAccountID&&(n=t)}),n)?(i.isSplitBilling=!1,n.AccountType.MaxPercentageOfOrderTotal!=100)?(i.isSplitBilling=!0,!1):n.Balance<i.currentOrder.Total?(i.isSplitBilling=!n.AccountType.AllowExceed,n.AccountType.AllowExceed):!0:!1},t=!1;switch(n){case"Undetermined":t=i.user.Permissions.contains("SubmitForApproval");break;case"PurchaseOrder":t=i.user.Permissions.contains("PayByPO");break;case"BudgetAccount":t=i.user.Permissions.contains("PayByBudgetAccount"),t=t?r():t;break;case"CreditCard":t=i.user.Permissions.contains("PayByCreditCard");break;default:return!1}return t}n.query(function(n){i.SpendingAccounts=n,r(i.currentOrder.BudgetAccountID)}),i.$watch("currentOrder.BillAddressID",function(n){n&&t.get(n,function(n){i.user.Permissions.contains("EditBillToName")&&!n.IsCustEditable&&(i.currentOrder.BillFirstName=n.FirstName,i.currentOrder.BillLastName=n.LastName),i.BillAddress=n})}),i.$on("event:AddressCancel",function(){i.billaddressform=!1}),i.$watch("currentOrder.PaymentMethod",function(n){if(n=="BudgetAccount"&&i.SpendingAccounts)if(i.SpendingAccounts.length==1)i.currentOrder.BudgetAccountID=i.SpendingAccounts[0].ID;else{var r=0,t;angular.forEach(i.SpendingAccounts,function(n){n.AccountType.PurchaseCredit&&(r+=1,t=n)}),r==1&&t&&(i.currentOrder.BudgetAccountID=t.ID)}else!i.isSplitBilling&&i.currentOrder&&(i.currentOrder.BudgetAccountID=null,i.currentOrder.currentBudgetAccount=null);i.cart_billing.$setValidity("paymentMethod",u(n))});var r=function(n){var t,r;n&&(t=u("BudgetAccount"),angular.forEach(i.SpendingAccounts,function(t){t.ID==n&&(i.currentBudgetAccount=t)}),r=i.currentBudgetAccount.AccountType.MaxPercentageOfOrderTotal!=100?i.currentOrder.Total*i.currentBudgetAccount.AccountType.MaxPercentageOfOrderTotal*.01:i.currentBudgetAccount.Balance,i.remainingOrderTotal=i.currentOrder.Total-r,i.cart_billing.$setValidity("paymentMethod",t))};i.$watch("currentOrder.Total",function(){i.currentOrder&&i.currentOrder.BudgetAccountID&&r(i.currentOrder.BudgetAccountID)}),i.$watch("currentOrder.BudgetAccountID",function(n){i.currentBudgetAccount=null,r(n)})}]}}]),four51.app.directive("orderapprovals",function(){return{restrict:"AE",templateUrl:"partials/controls/orderApprovals.html"}}),four51.app.directive("daterange",function(){return{scope:{options:"=ngOptions",fromdate:"=fromdate",todate:"=todate"},restrict:"E",templateUrl:"partials/controls/dateRange.html",controller:["$scope",function(n){var t={LastDay:function(){var t=new Date,i=t.getDate();t.setDate(i-1),n.fromdate=t,n.todate=t},LastWeek:function(){var t=new Date,i=t.getDate();t.setDate(i-7),n.fromdate=t,n.todate=new Date},LastMonth:function(){var t=new Date,i=t.getMonth();t.setMonth(i-1),n.fromdate=t,n.todate=new Date},LastThreeMonths:function(){var t=new Date,i=t.getMonth();t.setMonth(i-3),n.fromdate=t,n.todate=new Date},LastYear:function(){var t=new Date,i=t.getYear();t.setYear(i-1),n.fromdate=t,n.todate=new Date}};n.changed=function(){t[n.span]()}}]}}),four51.app.directive("cartprint",function(){return{restrict:"E",templateUrl:"partials/cartPrintView.html"}}),four51.app.directive("orderprint",function(){return{restrict:"E",templateUrl:"partials/orderPrintView.html"}})